(()=>{var r="https://stuff.kekley.online";async function g(){let o=r+"/getSplash",e=await(await fetch(o,{method:"GET",mode:"cors"})).text(),n=JSON.parse(e);return"splash"in n?n.splash:""}async function p(o){let t={token:o},e=r+"/verifyToken",n=await fetch(e,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});try{if(!n.ok)return{error:`Response status: ${n.status}`};let s=await n.json();return console.log(s),s}catch(s){return console.log(s),{error:`${s}`}}}async function y(o){if(o.length==0)return{error:"username cannot be empty"};let t={display_name:o},e=r+"/registerName",n=await fetch(e,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});try{if(!n.ok)throw new Error(`Response status: ${n.status}`);let s=await n.json();return console.log(s),s}catch(s){return console.log(s),{error:`${s}`}}}function h(o){let t=new EventSource(r+"/subscribeShouts");t.onopen=()=>{console.log("SSE connected")},t.onmessage=e=>{o(JSON.parse(e.data))},t.onerror=()=>{console.log("SSE state:",t.readyState===EventSource.CONNECTING?"reconnecting":"closed")}}async function f(o){let t={};(o!=null||o!=null)&&(t.shouts_before_id=o);let e=r+"/getShouts",n=await fetch(e,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});try{if(!n.ok)throw new Error(`Response status: ${n.status}`);let s=await n.json();return console.log(s),s}catch(s){console.log(s)}}async function _(o,t){let e={token:o,content:t},n=r+"/postShout",s=await fetch(n,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});try{if(!s.ok)throw new Error(`Response status: ${s.status}`);let l=await s.json();return console.log(JSON.stringify(l)),l}catch(l){return console.log(l),{error:`${l}`}}}function S(){this.style.display="block"}function j(){this.style.display="none"}function b(o,t){var e=S.bind(t);o.onclick=e}function c(o,t){var e=j.bind(t);window.addEventListener("click",function(n){n.target==t&&(t.style.display="none")}),o.onclick=e}function d(o){return`<div class="shoutbox-message">
    <p><span style="color:${o.user_color};"class="shoutbox-username">${o.display_name}</span>:${o.content}</p>
    </div>`}window.addEventListener("load",async o=>{document.title=await g()});function T(){let o=document.getElementsByClassName("login-button");for(let s=0;s<o.length;++s){let l=o[s];l.style.display="none"}let t=document.getElementById("shoutbox-ui");t.style.display="flex";let e=document.getElementById("login-modal");e.style.display="none";let n=document.getElementById("token-login-modal");n.style.display="none"}function k(){let o=document.getElementsByClassName("login-button");for(let e=0;e<o.length;++e){let n=o[e];n.style.display="block"}let t=document.getElementById("shoutbox-ui");t.style.display="none"}async function m(o){localStorage.setItem("logged_in",!1);let t=await p(o);if("is_valid"in t){let e=t.is_valid;return localStorage.setItem("logged_in",e),e==!0?(localStorage.setItem("token",o.trim()),T(),!0):(k(),!1)}}var u=localStorage.getItem("token");u&&u.length==32?m(u):k();var E=document.getElementById("login-modal"),x=document.getElementById("modal-close-button"),w=document.getElementsByClassName("login-button");for(let o=0;o<w.length;++o){let t=w[o];b(t,E)}c(x,E);var I=document.getElementById("token-login-modal"),B=document.getElementById("token-login-modal-close-button");c(B,I);var O=document.getElementById("confirmation-modal"),v=document.getElementById("confirmation-modal-close-button");c(v,O);var $=document.getElementById("token-login-button");$.onclick=async function(){let t=document.getElementById("token-login-token").value.trim();if(await m(t)){let n=document.getElementById("confirmation-modal"),s=document.getElementById("confirmation-message");n.style.display="block",s.innerHTML="<p>you're logged in! the site will remember your login on this device until you clear your cookies or if you are accessing it in a private browser window.</p>"}};var N=document.getElementById("login-submit");N.onclick=async function(){let o=document.getElementById("display-name-input"),t=document.getElementById("login-messages"),e=o.value.trim(),n=await y(e);if("error"in n){let s=n.error;if(s==="NAME_TAKEN"){let l=document.getElementById("login-modal");l.style.display="none";let i=document.getElementById("token-login-modal"),a=document.getElementById("token-login-name");a.innerHTML=e,i.style.display="block"}else t.innerHTML=s,console.log(JSON.stringify(n))}else if("token"in n){let s=n.token.trim();if(await m(s)){let i=document.getElementById("confirmation-modal"),a=document.getElementById("confirmation-message");i.style.display="block",a.innerHTML=`<p>you're logged in! the site will remember your login on this device until you clear your cookies but not if you are accessing it in a private browser window.
                if you would like to sign in with this name on another device or otherwise need to sign back in you will need the following token. think of it like a password and keep it somewhere safe. if you do lose it though just ask me for help
                </p><b>${s}</b>`}}};window.addEventListener("load",async o=>{let t=await f(null),e=document.getElementById("shoutbox-messages");if("shouts"in t){let n=t.shouts,s=document.getElementById("shoutbox-scroll");for(let l=0;l<n.length;++l){let i=n[l];console.log(i);let a=d(i);e.innerHTML+=a}s.scrollTop=s.scrollHeight}});var C=document.getElementById("shoutbox-send");C.onclick=async function(){let o=document.getElementById("shoutbox-textarea");if(o.value.length==0)return;let t=localStorage.getItem("token"),e=o.value.trim(),n=await _(t,e);"error"in n||(o.value=""),console.log(n)};var J=function(o){let t=document.getElementById("shoutbox-messages"),e=document.getElementById("shoutbox-scroll"),n=e.scrollTop+e.clientHeight>=e.scrollHeight-1,s=d(o);t.innerHTML+=s,n&&(e.scrollTop=e.scrollHeight)};h(J);})();
